\chapter{Metodologia} % ============================================================================================== %
\section{Abordagem Computacional} % ================================================================================== %

O projeto foi desenvolvido em \textit{Python} versão 3.12. Toda as etapas, da obtenção dos dados de entrada à implementação
dos modelos computacionais foram organizadas em módulos. Todas as etapas de processamento intensivo foram realizadas em
paralelo, utilizando todas as \textit{threads} disponíveis do sistema. 

As etapas referentes ao modelo neural foram realizadas apenas no \textit{Central Processing Unit} (CPU), devido à
incompatibilidade da biblioteca \textit{torch} com placas de vídeo AMD no Windows, com suporte apenas para placas NVIDIA.
O sistema utilizado possui um processador AMD Ryzen 5900X e 32 GB de memória RAM. A tabela \ref{tab:bibliotecas} mostra 
as bibliotecas utilizadas no projeto, suas finalidades e versões.

\begin{table}[htb]
  \centering
   \IBGEtab{
    \caption{Bibliotecas utilizadas no projeto}
    \label{tab:bibliotecas}
    }{
    \begin{tabular}{llll}
  		  \hline
    	  \textbf{Biblioteca} & \textbf{Descrição} & \textbf{Versão} \\ \hline
        numpy & Cálculos numéricos e manipulação de arrays & 1.26.4 \\
        pandas & Manipulação e análise de dados (DataFrames) & 2.2.3 \\
        requests & Requisições HTTP & 2.32.3 \\
        urllib3 & Gerenciamento de conexões HTTP & 2.2.3 \\
        alive\_progress & Barra de progresso para loops & 3.2.0 \\
        netCDF4 & Leitura de arquivos NetCDF & 1.7.2 \\
        cdsapi & API para download de dados do ECMWF & 0.7.5 \\
        geopandas & Manipulação de dados geoespaciais & 1.0.1 \\
        matplotlib & Visualização de dados & 3.9.2 \\
        scikit-learn & Aplicação de modelos iniciais & 1.5.2 \\
        scipy & Ferramentas e algoritmos matemáticos & 1.14.1 \\
        transformers & Modelos Neurais Pré-treinadis & 4.52.3 \\
        torch & Processamento de Redes Neurais & 2.7.0 \\
        \hline
    \end{tabular}
    }{
      \fonte{o autor.}}
\end{table}

\section{Obtenção e Pré Processamento dos Dados} % =================================================================== %
\subsection{Obtenção dos Dados Energéticos e Hidrológicos} % ========================================================= %

A primeira etapa do projeto consiste na consolidação das séries históricas de geração, carga e variáveis hidrológicas,
que são disponibilizadas publicamente no portal Dados Abertos do ONS, a partir do ano 2000. As séries referentes 
às variáveis hidrológicas são disponibilizadas em base diária, e os dados de geração e carga são disponibilizados em 
base horária. As Tabelas \ref{tab:geracao} e \ref{tab:carga} mostram os parâmetros dos dados de geração e carga, respectivamente.

Os dados de geração são disponibilizados em Mega Watt médio (MWmed) por fonte de energia, subsistema, estado, 
modalidade de operação, entre outras variáveis. Os dados de carga também são disponibilizados em MWmed e contêm 
informações sobre a carga em cada subsistema do SIN.

\begin{table}[htb]
  \centering
   \IBGEtab{
    \caption{Parâmetros dos dados de geração}
    \label{tab:geracao}
    }{
      \begin{tabular}{llll}
          \hline
          \textbf{Parâmetro} & \textbf{Descrição} & \textbf{Tipo} \\ \hline
          din\_instante & Instante de aferição & Datetime\\
          nom\_subsistema & Subsistema da usina & String\\
          id\_estado & Estado onde a usina está localizada & String\\ 
          nom\_tipousina & Tipo de usina & String\\
          nom\_tipocombustivel & Tipo de combustível & String\\
          nom\_usina & Nome da usina & String\\
          val\_geracao & Geração de energia (MWmed) & Float\\ \hline
      \end{tabular}
    } {
      \fonte{\citeonline{pen2024}}
      \nota{Variáveis não utilizadas foram omitidas.}
    }
\end{table}

Para as séries de geração, os dados de 2000 a 2021 são agrupados pelos respectivos anos, e a partir de 2022,
as informações estão agrupadas em arquivos por mês e ano. Para as séries de carga, os dados são disponibilizados por
ano. Como o ONS não disponibiliza \textit{Aplication Programming Interface} (API) para a obtenção dos dados diretamente, foi 
necessário uma outra abordagem, a fim de evitar o \textit{download} manual dos dados. 

Um script foi desenvolvido para fazer o download dos dados por meio de requisições HTTP, utilizando as bibliotecas 
\textit{requests} e \textit{urllib3} para gerenciar as conexões. Todos os downloads foram realizados em paralelo, utilizando 
todas as threads disponíveis do sistema. Ao todo, cerca de 10 GB de dados em arquivos Comma Separated Values (CSV) foram consolidados.

% fazer um fluxograma dessas funções e passar o codigo pro anexo

\begin{table}[htb]
  \centering
   \IBGEtab{
    \caption{Parâmetros dos dados de carga}
    \label{tab:carga}
    }{
    \begin{tabular}{llll}
  		  \hline
    	  \textbf{Parâmetro} & \textbf{Descrição} & \textbf{Tipo} \\ \hline
        din\_instante & Instante de aferição & Datetime\\
        nom\_subsistema & Subsistema da usina & String\\
        val\_cargaenergiahomwmed & Carga de energia (MWmed) & Float\\ \hline
    \end{tabular}
    }{
      \fonte{\citeonline{pen2024}}}
\end{table}

Os dados de geração contém informações que permitem uma análise detalhada em diferentes níveis de granulidade. Dessa maneira, 
possíveis impactos em diferentes escalas geográficas e temporais poderão ser avaliados.

\subsection{Pré Processamento dos Dados de Geração e Carga} % ======================================================== %
Com as séries históricas de geração e carga consolidadas, se faz necessário preparar os dados para que possam ser utilizados 
nos modelos computacionais. Essa etapa envolve a verificação, transformação e limpeza dos dados. Utilizando a biblioteca
\textit{pandas}, todos os arquivos com o histórico de geração e carga foram lidos e consolidados em dois \textit{DataFrames} 
distintos, estrutura de dados tabulares da biblioteca. Com isso, as seguintes operações foram realizadas:
\begin{itemize}
    \item Seleção das colunas relevantes;
    \item Verificação de valores inválidos e tratamento de valores ausentes;
    \item Agrupamento dos tipos de usinas por classes: hidráulica, térmica, eólica, fotovoltaica e outras;
    \item Reamostragem para diferentes bases temporais, considerando a geração média (MWmed) e energia gerada (MWh);
    \item Agrupamento dos dados de geração por subsistema e classe.
\end{itemize}

\begin{figure}[!ht]
	\IBGEtab{\caption{Subsistemas do SIN}
			 \label{fig:subsistemas_brasil}}
	{\includesvg[scale=1]{figuras/subsistemas_brasil}}
	{\fonte{o autor.}}
\end{figure}

Optou-se por fazer o agrupamento dos dados de geração por subsistema e fonte para permitir avaliar os impactos das variáveis
do ENSO em diferentes regiões do Brasil. Além disso, a representação por subsistema também é utilizada pelo modelo NEWAVE. 
A figura \ref{fig:subsistemas_brasil} mostra os subsistemas do SIN.

Diferentes arquivos CSV foram gerados, considerando a geração média (MWmed) e energia gerada (MWh) para as escalas diária e mensal.
Os dados de geração contém o histórico de geração por subsistema e fonte, enquanto que os dados de carga contém o histórico de carga
por subsistema. Considerando o período de 2000 a 2024, foram consolidados ao todo 9132 amostras diárias e 300 amostras mensais.


\subsection{Pré Processamento dos Dados Hidrológicos} % ============================================================== %

\subsection{Obtenção dos Dados do ENSO} % ============================================================================ %

\subsection{Pré Processamento dos Dados do ENSO} % =================================================================== %


\section{Análise Exploratória dos Dados} % =========================================================================== %

\subsection{Dados de Geração e carga} % ============================================================================== %

\subsection{Dados Hidrológicos} % ==================================================================================== %

\subsection{Dados do ENSO} % ========================================================================================= %


\section{Implementação dos Modelos de Regressão} % =================================================================== %

\subsection{Modelo Linear} % ========================================================================================= %

\subsection{Modelo Não Linear} % ===================================================================================== %


\section{Implementação do Modelo Neural} % =========================================================================== %

\subsection{Sem Variáveis Exógenas} % ================================================================================ %

\subsection{Com Variáveis Exógenas} % ================================================================================ %