\chapter{Metodologia} % ============================================================================================== %
\section{Abordagem Computacional} % ================================================================================== %

O projeto foi desenvolvido em \textit{Python} versão 3.12. Toda as etapas, da obtenção dos dados de entrada à implementação
dos modelos computacionais foram organizadas em módulos. Todas as etapas de processamento intensivo foram realizadas em
paralelo, utilizando todas as \textit{threads} disponíveis do sistema. 

As etapas referentes ao modelo neural foram realizadas apenas no \textit{Central Processing Unit} (CPU), devido à
incompatibilidade da biblioteca \textit{torch} com placas de vídeo AMD no Windows, com suporte apenas para placas NVIDIA.
O sistema utilizado possui um processador AMD Ryzen 5900X e 32 GB de memória RAM. A tabela \ref{tab:bibliotecas} mostra 
as bibliotecas utilizadas no projeto, suas finalidades e versões.

\begin{table}[htb]
  \centering
   \IBGEtab{
    \caption{Bibliotecas utilizadas no projeto}
    \label{tab:bibliotecas}
    }{
    \begin{tabular}{llll}
  		  \hline
    	  \textbf{Biblioteca} & \textbf{Descrição} & \textbf{Versão} \\ \hline
        numpy & Cálculos numéricos e manipulação de arrays & 1.26.4 \\
        pandas & Manipulação e análise de dados (DataFrames) & 2.2.3 \\
        requests & Requisições HTTP & 2.32.3 \\
        urllib3 & Gerenciamento de conexões HTTP & 2.2.3 \\
        alive\_progress & Barra de progresso para loops & 3.2.0 \\
        netCDF4 & Leitura de arquivos NetCDF & 1.7.2 \\
        cdsapi & API para download de dados do ECMWF & 0.7.5 \\
        geopandas & Manipulação de dados geoespaciais & 1.0.1 \\
        matplotlib & Visualização de dados & 3.9.2 \\
        scikit-learn & Aplicação de modelos iniciais & 1.5.2 \\
        scipy & Ferramentas e algoritmos matemáticos & 1.14.1 \\
        transformers & Modelos Neurais Pré-treinadis & 4.52.3 \\
        torch & Processamento de Redes Neurais & 2.7.0 \\
        \hline
    \end{tabular}
    }{
      \fonte{o autor.}}
\end{table}

\section{Obtenção e Pré Processamento dos Dados} % =================================================================== %
\subsection{Obtenção dos Dados Energéticos e Hidrológicos} % ========================================================= %

A primeira etapa do projeto consiste na consolidação das séries históricas de geração, carga e variáveis hidrológicas,
que são disponibilizadas publicamente no portal Dados Abertos do ONS, a partir do ano 2000. As séries referentes 
às variáveis hidrológicas são disponibilizadas em base diária, e os dados de geração e carga são disponibilizados em 
base horária. As Tabelas \ref{tab:hidrologicos}, \ref{tab:carga} e \ref{tab:geracao} mostram os parâmetros dos dados hidrológicos, 
carga e geração, respectivamente.

Os dados de geração são disponibilizados em Mega Watt médio (MWmed) por fonte de energia, subsistema, estado, 
modalidade de operação, entre outras variáveis. Os dados de carga também são disponibilizados em MWmed e contêm 
informações sobre a carga em cada subsistema do SIN.

\begin{table}[htb]
  \centering
   \IBGEtab{
    \caption{Parâmetros dos dados hidrológicos}
    \label{tab:hidrologicos}
    }{
      \begin{tabular}{llll}
          \hline
          \textbf{Parâmetro} & \textbf{Descrição} & \textbf{Tipo} \\ \hline
          din\_instante & Instante de aferição & Datetime\\
          nom\_subsistema & Subsistema & String\\
          tip\_reservatorio & Tipo de reservatório & String\\
          nom\_bacia  & Bacia hidrográfica & String\\
          nom\_ree & Nome do REE & String\\
          val\_nivelmontante & Valor do nível montante (m) & Float\\
          val\_niveljusante & Valor do nível jusante (m) & Float\\
          val\_volumeutilcon & Volume útil consistido (\%) & Float\\
          val\_vazaoafluente & Vazão afluente (m³/s) & Float\\
          val\_vazaoturbinada & Vazão turbinada (m³/s) & Float\\
          val\_vazaovertida & Vazão vertida (m³/s) & Float\\
          val\_vazaodefluente & Vazão defluente (m³/s) & Float\\
          val\_vazaoevaporacaoliquida & Vazão de evaporação líquida (m³/s) & Float\\ \hline
      \end{tabular}
    } {
      \fonte{\citeonline{pen2024}}
      \nota{Variáveis não utilizadas foram omitidas.}
    }
\end{table}

Para as séries de geração, os dados de 2000 a 2021 são agrupados pelos respectivos anos, e a partir de 2022,
as informações estão agrupadas em arquivos por mês e ano. Para as séries de carga, os dados são disponibilizados por
ano. Como o ONS não disponibiliza \textit{Aplication Programming Interface} (API) para a obtenção dos dados diretamente, foi 
necessário uma outra abordagem, a fim de evitar o \textit{download} manual dos dados. 

\begin{table}[htb]
  \centering
   \IBGEtab{
    \caption{Parâmetros dos dados de carga}
    \label{tab:carga}
    }{
    \begin{tabular}{llll}
  		  \hline
    	  \textbf{Parâmetro} & \textbf{Descrição} & \textbf{Tipo} \\ \hline
        din\_instante & Instante de aferição & Datetime\\
        nom\_subsistema & Subsistema da usina & String\\
        val\_cargaenergiahomwmed & Carga de energia (MWmed) & Float\\ \hline
    \end{tabular}
    }{
      \fonte{\citeonline{pen2024}}}
\end{table}

Um script foi desenvolvido para fazer o download dos dados por meio de requisições HTTP, utilizando as bibliotecas 
\textit{requests} e \textit{urllib3} para gerenciar as conexões. Todos os downloads foram realizados em paralelo, utilizando 
todas as threads disponíveis do sistema. Ao todo, cerca de 10 GB de dados em arquivos Comma Separated Values (CSV) foram consolidados.

\begin{table}[htb]
  \centering
   \IBGEtab{
    \caption{Parâmetros dos dados de geração}
    \label{tab:geracao}
    }{
      \begin{tabular}{llll}
          \hline
          \textbf{Parâmetro} & \textbf{Descrição} & \textbf{Tipo} \\ \hline
          id\_subsistema & Instante de aferição & Datetime\\
          nom\_subsistema & Subsistema da usina & String\\
          id\_estado & Estado onde a usina está localizada & String\\ 
          nom\_tipousina & Tipo de usina & String\\
          nom\_tipocombustivel & Tipo de combustível & String\\
          nom\_usina & Nome da usina & String\\
          val\_geracao & Geração de energia (MWmed) & Float\\ \hline
      \end{tabular}
    } {
      \fonte{\citeonline{pen2024}}
      \nota{Variáveis não utilizadas foram omitidas.}
    }
\end{table}

Os dados de geração contém informações que permitem uma análise detalhada em diferentes níveis de granulidade. Dessa maneira, 
possíveis impactos em diferentes escalas geográficas e temporais poderão ser avaliados.

\subsection{Pré Processamento dos Dados de Geração e Carga} % ======================================================== %
Com as séries históricas de geração e carga consolidadas, se faz necessário preparar os dados para que possam ser utilizados 
nos modelos computacionais. Essa etapa envolve a verificação, transformação e limpeza dos dados. Utilizando a biblioteca
\textit{pandas}, todos os arquivos com o histórico de geração e carga foram lidos e consolidados em dois \textit{DataFrames} 
distintos, estrutura de dados tabulares da biblioteca. Com isso, as seguintes operações foram realizadas:
\begin{itemize}
    \item Seleção das colunas relevantes;
    \item Verificação de valores inválidos e tratamento de valores ausentes;
    \item Agrupamento dos tipos de usinas por classes: hidráulica, térmica, eólica, fotovoltaica e outras;
    \item Reamostragem para diferentes bases temporais, considerando a geração média (MWmed) e energia gerada (MWh);
    \item Agrupamento dos dados de geração por subsistema e classe.
\end{itemize}

\begin{figure}[!ht]
	\IBGEtab{\caption{Subsistemas do SIN segundo o ONS}
			 \label{fig:subsistemas_brasil}}
	{\includesvg[scale=1]{figuras/subsistemas_brasil}}
	{\fonte{o autor.}}
\end{figure}

Optou-se por fazer o agrupamento dos dados de geração por subsistema e fonte para permitir avaliar os impactos das variáveis
do ENSO em diferentes regiões do Brasil. Além disso, a representação por subsistema também é utilizada pelo modelo NEWAVE. 
A figura \ref{fig:subsistemas_brasil} mostra os subsistemas do SIN.

Diferentes arquivos CSV foram gerados, considerando a geração média (MWmed) e energia gerada (MWh) para as escalas diária e mensal.
Os dados de geração contém o histórico de geração por subsistema e fonte, enquanto que os dados de carga contém o histórico de carga
por subsistema. Considerando o período de 2000 a 2024, foram consolidados ao todo 9132 amostras diárias e 300 amostras mensais.

\subsection{Pré Processamento dos Dados Hidrológicos} % ============================================================== %
Os dados hidrológicos contém informações sobre o nível dos reservatórios e vazões. Para o contexto do projeto, espera-se que
essas informações sejam altamente correlacionados com a geração hidrelétrica, o que será verificado a seguir na seção de análise 
exploratória.

Sendo assim, os dados hidrológicos foram utilizados para verificar a performance dos modelos quando as variáveis de entrada
possuem alta correlação com a variável de saída. Dessa forma, é estabelecida uma referência para comparação entre os
resultados dos modelos.

As séries históricas foram consolidadas em um único \textit{DataFrame}, contendo as vazões totais em cada subsistema do SIN,
considerando a soma das vazões de todos os reservatórios em cada subsistema, em base diária.

\subsection{Obtenção dos Dados do ENSO} % ============================================================================ %
Os dados do ENSO foram obtidos a partir do \textit{Climate Data Store} (CDS) do ECMWF. O CDS é um banco de dados com diversos
\textit{datasets} de variáveis climáticas de diferentes regiões do mundo. Para esse projeto, o dataset utilizado foi o 
\textit{ERA5 post-processed daily statistics on single levels from 1940 to present}, que contém dados diários de diversas 
variáveis, incluindo a temperatura da superfície do mar (SST).

Considerando que ENSO é um fenômeno definido pela temperatura da superfície do mar em regiões 
específicas do Oceano Pacífico, e que os dados de geração, carga e hidrológicos são disponibilizados em base diária,
optou-se por utilizar a temperatura absoluta da superfície do mar em base diária para cada uma das regiões do ENSO. As
regiões do ENSO e suas coordenadas geográficas são mostradas na Tabela \ref{tab:regioes_enso}.

\begin{table}[htb]
  \centering
   \IBGEtab{
    \caption{Regiões do ENSO}
    \label{tab:regioes_enso}
    }{
    \begin{tabular}{lll}
  		  \hline
    	  \textbf{Região} & \textbf{Latitude} & \textbf{Longitude} \\ \hline
        Niño 1+2 & -10° a 0° & -90° a -80° \\
        Niño 3 & -5° a 5° & -150° a -90° \\
        Niño 3.4 & -5° a 5° & -170° a -120° \\
        Niño 4 & -5° a 5° & -160° a -150° \\ \hline
    \end{tabular}
    }{
      \fonte{\citeonline{TheDefinitionofElNio}}}
\end{table}

Os dados foram obtidos usando a biblioteca \textit{cdsapi}, que permite acessar o CDS através da
API do ECMWF. O script desenvolvido para essa etapa realiza o download dos dados de temperatura da superfície do mar
para cada uma das regiões do ENSO, considerando o período de 2000 a 2024. Os dados são obtidos em formato NetCDF, que é 
um formato de arquivo utilizado para armazenar dados científicos multidimensionais.

\subsection{Pré Processamento dos Dados do ENSO} % =================================================================== %
Após o download, os arquivos NetCDF são processados para extrair as informações relevantes para cada região do ENSO. 
Utilizando a biblioteca \textit{netCDF4}, cada arquivo anual é lido para extrair as dimensões de tempo, latitude e longitude, 
além da variável de interesse, a temperatura da superfície do mar (SST).

O processamento segue as seguintes etapas:
\begin{itemize}
\item Conversão do formato das coordenadas de longitude, de $ [0 a 360] $ graus, para -180 a 180 graus;
\item Para cada uma das regiões do ENSO, um subconjunto geográfico dos dados globais é criado, selecionando os pontos
de latitude e longitude que se encontram dentro dos limites de cada região;
\item A média espacial da variável é calculada para cada dia sobre este subconjunto. Esse processo resulta em uma única série
temporal diária, que representa o valor médio da variável para aquela região específica;
\item Ao final, as séries temporais anuais de cada região são consolidadas, formando um conjunto de dados único que abrange
todo o período de análise, de 2000 a 2024.
\end{itemize}

Em resumo, o processo transforma os dados brutos multidimensionais em séries temporais diárias para cada região
do ENSO, que agora estão prontas para serem utilizadas como variáveis exógenas nos modelos computacionais.


\section{Análise Exploratória dos Dados} % =========================================================================== %

\subsection{Dados de Geração e carga} % ============================================================================== %

\subsection{Dados Hidrológicos} % ==================================================================================== %

\subsection{Dados do ENSO} % ========================================================================================= %


\section{Implementação dos Modelos de Regressão} % =================================================================== %
Para o modelo linear, foi utilizado o modelo de regressão linear múltipla, uma técnica estatística que busca modelar
a relação entre uma variável dependente e várias variáveis independentes, conforme descrito pela equação \ref{eq:regressao_linear}.
Nesse contexto, a vartiável dependente é a geração de uma determinada fonte em um subsistema do SIN, e as variáveis independentes
são as variáveis auxiliares (ou exógenas), como dados de SST, carga e hidrológicos.

Para os modelos não linear e neural, a técnica de previsão multivariada foi utilizada, uma abordagem que permite estimar
múltiplas variáveis dependentes simultaneamente a partir de um conjunto de variáveis independentes. Essa técnica é especialmente 
útil quando as variáveis dependentes são interdependentes e podem influenciar umas às outras. Nesse contexto, 
os modelos são capazes de capturar as relações entre cada fonte de geração, além das relações entre as variáveis exógenas.

\subsection{Modelo Linear} % ========================================================================================= %

\subsection{Modelo Não Linear} % ===================================================================================== %


\section{Implementação do Modelo Neural} % =========================================================================== %

\subsection{Sem Variáveis Exógenas} % ================================================================================ %

\subsection{Com Variáveis Exógenas} % ================================================================================ %